<header>
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/">PinPic</a>
    </div>
    <div class="header-right">
      <div class="free-word">
        <%= search_form_for @p, url: search_pictures_path, class: "free-word-form" do |f| %>
          <%= f.search_field :text_cont, placeholder: 'キーワードから探す', class: "free-word-filed" %>
          <%= f.hidden_field :public_private_eq, value: "公開" %>
          <%= button_tag type: :submit, class: 'search-button' do %>
            <%= image_tag "search.png", class: "search-icon" %>
          <% end %>
        <% end %>
      </div>
      <ul class="session">
      <% if user_signed_in? %>
        <li><%= link_to 'マイページ', user_picture_path(current_user) %></li>
        <li><%= link_to 'ログアウト', destroy_user_session_path, method: :delete %></li>
      <% else %>
        <li><%= link_to 'ログイン', new_user_session_path %></li>
        <li><%= link_to '新規登録', new_user_registration_path %></li>
      <% end %>
      </ul>
    </div>
  </div>
</header>
<div class="current-user-name">
  <% if user_signed_in? %>
    現在のユーザー：<%= current_user.nickname  %>
  <% end %>
</div>
<div class="whole-wrapper">
  <div class="side-bar">
    <% if user_signed_in? %>
       <span class="new-post-link">新規投稿</span>
        <div class="post-message">
          ※著作権に違反するような<br>画像の投稿はお控えいただけ<br>ますようお願いします。
        </div>
        <div class="new-post">
          <%= form_with model: @picture, class: "new-post-form", local: true do |f| %>
          <%= render 'error_messages', model: f.object %>
            <%= label :text, 'タイトル (20文字以内)', class: "post-title" %>
            <br><%= f.text_field :text, class: "text-field", placeholder: 'タイトルを入力してください', maxlength: 20, size: "30" %>
            <label>
            <br><%= f.label :image, '画像', class: "post-image-label" %>
            <br><%= f.file_field :image, class: "post-image-field" ,placeholder: 'Image url', size: "15" %>
            <br><input name="picture[public_private]" value="非公開" type="hidden">
            <br><%= f.submit '送信', class: "" %>
          <% end %>
        </div>
    <% end %>
  </div>
  <% if @results.nil? %>
    <div class="contents-wrapper">
      <div class="index-title">
      みんなの投稿一覧
      </div>
      <div class="picture-container">
        <% if @pictures.present? %>
          <% @pictures.each do |picture| %>
            <div class="index-contents">
              <div class="picture-wrapper">
                <%= link_to image_tag(picture.image , width: '100%', height: '100%', alt: "画像"), picture_path(picture), class: "picture" %>
                <%= image_tag 'picture-pin2.png', class: "picture-pin" %>
              </div>
              <div class="description">
                <div class="title">
                  <p><%= picture.text %></p>
                </div>
                <div class="user-name">
                  <%= link_to "投稿者: #{picture.user.nickname}", user_picture_path(picture.user.id) %>
                </div>
                <div class="favorite-count">
                  <div class="icon">
                    <%= image_tag 'heart-icon', class: "heart-icon" %>
                    <%= picture.favorites.count %>
                  </div>
                </div>
              </div>
            </div>
            <!--<% if user_signed_in? %>
              <% if picture.favorited_by?(current_user) %>
                <p><span>お気に入り解除: </span><%=link_to picture.favorites.count, picture_favorites_path(picture.id), method: :delete %></p>
              <% else %>
                <p><span>お気に入り登録: </span><%=link_to picture.favorites.count, picture_favorites_path(picture.id), method: :post %></p>
              <% end %>
            <% else %>
              <p><span>お気に入り数: </span><%= picture.favorites.count %></p>
            <% end %>-->
          <% end %>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="contents-wrapper">
      <div class="index-title">
      検索結果一覧
      </div>
      <div class="picture-container">
        <% if @results.present? %>
          <% @results.each do |result| %>
            <div class="index-contents">
              <div class="picture-wrapper">
                <%= link_to image_tag(result.image , width: '100%', height: '100%', alt: "画像"), picture_path(result), class: "picture" %>
                <%= image_tag 'picture-pin2.png', class: "picture-pin" %>
              </div>
              <div class="description">
                <div class="title">
                  <p><%= result.text %></p>
                </div>
                <div class="user-name">
                  <%= link_to "投稿者: #{result.user.nickname}", user_picture_path(result.user.id) %>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
